<!-- Sección para buscar animales con arete oficial -->
<div class="row" *ngIf="!formularioVisible">
    <div class="col">
        <div class="card border border-info rounded">
            <div class="card-header bg-info text-white rounded-top font-weight-bold">
                Buscar animales con arete oficial
            </div>
            <form ngNativeValidate [formGroup]="formularioBusqueda" class="form-horizontal r-separator">
                <div class="card-body">
                    <div class="form-group row align-items-center mb-0">
                        <label class="col-md-3 text-right control-label col-form-label font-weight-bold">Tipo de
                            búsqueda</label>
                        <div class="col-md-4 border-left pb-2 pt-2">
                            <select formControlName="inputTipoConsulta" (change)="cambiarTipoParametro()"
                                class="form-control border-secondary font-weight-bold">
                                <option [value]="productor" selected enabled>Identificación del productor</option>
                                <option [value]="arete" selected enabled>Número de arete oficial</option>
                            </select>
                        </div>
                    </div>
                    <div *ngIf="tipoProductor" class="form-group row align-items-center mb-0">
                        <label class="col-md-3 text-right control-label col-form-label font-weight-bold">Identificación
                            productor</label>
                        <div class="col-md-4 border-left pb-2 pt-2 input-group">
                            <input type="text" class="form-control text-center border-secondary font-weight-bold"
                                autocomplete="on" formControlName="inputIdentificacion" maxlength="13"
                                placeholder="ingrese número de identificación" (input)="limpiarLista()">
                            <div class="input-group-append">
                                <button type="button" class="btn btn-info border-secondary font-weight-bold"
                                    (click)="buscarSitiosProductor()">
                                    <i class="fas fa-search"></i> Buscar
                                </button>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="tipoProductor" class="form-group row align-items-center mb-0">
                        <label class="col-md-3 text-right control-label col-form-label font-weight-bold">Sitios
                            activos</label>
                        <div class="col-md-8 border-left pb-2 pt-2">
                            <select formControlName="inputSitio" class="form-control border-secondary font-weight-bold"
                                #idSitio (change)="cambioSitio(idSitio.value)">
                                <option [value]="null" selected disabled>--- Seleccione una opción ---</option>
                                <option *ngFor="let area of listaAreas" [value]="area.idSitio">{{
                                    area.codigoSitio.toUpperCase()}} | {{ area.nombreProvinciaSitio.toUpperCase()}} - {{
                                    area.nombreCantonSitio.toUpperCase()}} | {{ area.nombre.toUpperCase() }}</option>
                            </select>
                        </div>
                    </div>
                    <div *ngIf="tipoProductor" class="form-group row align-items-center mb-0">
                        <label class="col-md-3 text-right control-label col-form-label font-weight-bold">Tipo
                            catastro</label>
                        <div class="col-md-4 border-left pb-2 pt-2 input-group">
                            <select class="form-control border-secondary font-weight-bold"
                                formControlName="inputTipoCatastro" (change)="cambioTipoCatastro()">
                                <option *ngFor="let tipo of listaTiposCatastro" [value]="tipo.codigo">{{ tipo.nombre }}
                                </option>
                            </select>
                        </div>
                    </div>
                    <div *ngIf="tipoProductor" class="form-group row align-items-center mb-0">
                        <label class="col-md-3 text-right control-label col-form-label font-weight-bold">Categoría
                            etaria</label>
                        <div class="col-md-4 border-left pb-2 pt-2 input-group font-weight-bold">
                            <select class="form-control border-secondary font-weight-bold"
                                formControlName="inputCategoria" (change)="cambioCategoria()">
                                <option [value]="null" selected disabled>--- Seleccione una opción ---</option>
                                <option *ngFor="let categoria of categorias" [value]="categoria.id_categoria">
                                    {{ categoria.nombre }}
                                </option>
                            </select>
                        </div>
                    </div>
                    <div *ngIf="!tipoProductor" class="form-group row align-items-center mb-0">
                        <label class="col-md-3 text-right control-label col-form-label font-weight-bold">Número de arete
                            oficial</label>
                        <div class="col-md-4 border-left pb-2 pt-2 input-group">
                            <input type="text" class="form-control border-secondary" autocomplete="on"
                                formControlName="inputIdOficial" placeholder="Ejemplo: EC006132716" maxlength="11">
                            <div class="input-group-append">
                                <button type="button" class="btn btn-info border-secondary font-weight-bold"
                                    (click)="buscarAnimales(true,true)">
                                    <i class="fas fa-search"></i> Buscar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Panel para mostrar datos del sitio seleccionado -->
<div class="row" *ngIf="!formularioVisible">
    <div class="col">
        <form ngNativeValidate [formGroup]="formularioDatosSitio" class="form-horizontal r-separator">
            <!-- Botón para ocultar/mostrar -->
            <div class="d-flex" style="gap: 50px;">
                <button *ngIf="isVisibleBotonDetalles" class="btn btn-info mb-3 font-weight-bold"
                    (click)="toggleVisibility()">
                    <i class="fas {{ isVisible ? 'fa-eye-slash' : 'fa-eye' }}"></i>
                    {{ isVisible ? 'Ocultar' : 'Mostrar' }} detalles del sitio
                </button>
                <!-- <button *ngIf="listaBovinos.length > 0" class="btn mb-3 font-weight-bold"
                    (click)="exportarListadoBovinosPDF()" title="Descargar registro de vacunación de animales"
                    style="background-color: #FFFF00; color: black; border-color: #FFFF00;">
                    <i class="fas fa-file-pdf" style="color: black;"></i>
                    Formato registro de vacunación
                </button> -->
            </div>
            <!-- Datos del sitio -->
            <div class="row" *ngIf="isVisible">
                <div class="col">
                    <div class="card border rounded">
                        <div class="card-body">
                            <table class="table mt-3 table-borderless v-middle custom-table">
                                <tbody>
                                    <tr>
                                        <td></td>
                                        <td class="pl-0 text-left">PROPIETARIO:</td>
                                        <td class="pl-0 text-left font-weight-medium">
                                            <p>
                                                <span class="pl-0 text-left font-weight-medium">
                                                    [{{
                                                    sitioSeleccionado?.numeroIdentificacion
                                                    }}]
                                                </span>
                                                <span>&nbsp;&nbsp;</span>
                                                <span class="pl-0 text-left font-weight-medium">
                                                    {{
                                                    sitioSeleccionado?.nombres.toUpperCase()
                                                    }}
                                                </span>
                                            </p>
                                        </td>
                                        <td class="pl-0 text-left">PROVINCIA:</td>
                                        <td class="pl-0 text-left font-weight-medium">{{
                                            sitioSeleccionado?.nombreProvinciaSitio.toUpperCase()
                                            }}</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td class="pl-0 text-left">CÓDIGO-SITIO:</td>
                                        <td class="pl-0 text-left font-weight-medium">

                                            <p><span class="badge rounded-pill font-weight-bold letra badge-info">
                                                    {{ sitioSeleccionado?.codigoSitio }}
                                                </span></p>
                                        </td>
                                        <td class="pl-0 text-left">CANTÓN:</td>
                                        <td class="pl-0 text-left font-weight-medium">{{
                                            sitioSeleccionado?.nombreCantonSitio.toUpperCase()
                                            }}</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td class="pl-0 text-left">TIPO ÁREA:</td>
                                        <td class="pl-0 text-left font-weight-medium">{{
                                            sitioSeleccionado?.nombreTipoArea.toUpperCase() }}
                                        </td>
                                        <td class="pl-0 text-left">PARROQUIA:</td>
                                        <td class="pl-0 text-left font-weight-medium">{{
                                            sitioSeleccionado?.nombreParroquiaSitio.toUpperCase()
                                            }}</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td class="pl-0 text-left">NOMBRE-SITIO:</td>
                                        <td class="pl-0 text-left font-weight-medium">{{
                                            sitioSeleccionado?.nombre.toUpperCase() }}</td>
                                        <td class="pl-0 text-left">DIRECCIÓN:</td>
                                        <td class="pl-0 text-left font-weight-medium">{{
                                            sitioSeleccionado?.callePrincipalSitio.toUpperCase()
                                            }}</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td class="pl-0 text-left">COORDENADAS:</td>
                                        <td class="pl-0 text-left font-weight-medium">
                                            LAT [{{ sitioSeleccionado?.latitudSitio }}] - LONG
                                            [{{
                                            sitioSeleccionado?.longitudSitio }}]
                                        </td>
                                        <td class="pl-0 text-left">MAPA:</td>
                                        <td class="pl-0 text-left font-weight-medium">
                                            <button class="styled-button bg-info"
                                                (click)="abrirGoogleMaps(sitioSeleccionado?.latitudSitio,sitioSeleccionado?.longitudSitio)">
                                                <i class="fas fa-map-marker-alt"></i>&nbsp;Ver
                                                en
                                                Google Maps
                                            </button>
                                        </td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<hr class="mt-0" />
<!-- Tabla con el resultado de la búsqueda -->
<div class="row" *ngIf="listaBovinos.length > 0 && !formularioVisible">
    <div class="col">
        <div class="card border-info rounded">
            <div class="card-header bg-secondary text-white" *ngIf="listaBovinos.length > 0">
                <span class="font-weight-bold">
                    Listado de animales con arete oficial
                </span>
                <span class="round rounded-circle text-white font-weight-bold d-inline-block text-center bg-info">{{
                    listaBovinos.length }}</span>
                <div class="btn-group ml-2" role="group" aria-label="Navegar">
                    <button (click)="anterior()" type="button" class="btn btn-success" *ngIf="inicio > 0"><i
                            class="fa fa-fast-backward"></i></button>
                    <button (click)="siguiente()" type="button" class="btn btn-success"
                        *ngIf="listaBovinos.length > 99"><i class="fa fa-fast-forward"></i></button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-wrapper-scroll-y custom-scrollbar">
                    <table class="table table-bordered table-hover v-middle">
                        <thead>
                            <tr>
                                <th class="badge-light-info font-16 text-center">ID</th>
                                <th class="badge-light-info font-16">Ubicación</th>
                                <th class="badge-light-info font-16 text-center">Descripción</th>
                                <th class="badge-light-info font-16 text-center">Operación</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let bovino of listaBovinos">
                                <td class="text-center">
                                    <span class="badge rounded-pill"
                                        [ngClass]="bovino?.codigoIdentificacion ? 'badge-amarillo' : 'badge-secondary'">
                                        {{ bovino?.codigoIdentificacion ? bovino.codigoIdentificacion : bovino.idBovino
                                        }}
                                    </span>
                                </td>
                                <td>
                                    <p><span class="badge rounded-pill font-weight-bold letra badge-info"
                                            style="font-size:small;">
                                            {{ bovino.codigoSitioActual }}
                                        </span></p>
                                    <p><span class="font-weight-bold" style="font-size:small;">{{
                                            bovino.nombreAreaActual.toUpperCase() }}</span></p>
                                    <p class="font-weight-bold" style="font-size:x-small;">
                                        [{{ bovino.numeroIdentificacionUsuarioActual }}] - {{
                                        bovino.nombresUsuarioActual
                                        }}
                                    </p>
                                    <p style="font-size:smaller;">
                                        {{ bovino.nombreProvinciaActual }} /
                                        {{ bovino.nombreCantonActual }} /
                                        {{ bovino.nombreParroquiaActual }}
                                    </p>
                                </td>
                                <td class="text-center">
                                    <p style="margin-bottom: 0.25rem;"><img
                                            style="vertical-align: middle; margin: 0 8px;" class="mr-3"
                                            src="assets/images/icon/vaca.svg" [hidden]="bovino.codigoSexo === 'macho'"
                                            width="40" alt="Generic placeholder image" />
                                        <img style="vertical-align: middle; margin: 0 8px;" class="mr-3"
                                            src="assets/images/icon/toro.svg" [hidden]="bovino.codigoSexo === 'hembra'"
                                            width="40" alt="Generic placeholder image" />
                                    </p>
                                    <p style="margin-bottom: 0.25rem;"><span class="font-weight-bold"
                                            style="font-size:small;">
                                            {{ bovino?.nombreCategoria ? bovino.nombreCategoria :
                                            bovino.nombreComunTaxonomia }}
                                        </span></p>
                                    <p style="margin-bottom: 0.25rem;"><span class="badge rounded-pill font-weight-bold"
                                            [ngClass]="{'badge-gris':bovino.estadoVacunacion=='vacunado', 'badge-light-danger':bovino.estadoVacunacion=='nacimiento'}">
                                            {{ bovino.estadoVacunacion.toLowerCase() }}
                                        </span></p>
                                    <p style="margin-bottom: 0.25rem;"><span class="font-weight-bold"
                                            style="font-size:small;">
                                            {{ bovino.nombreComunRaza }} ({{ bovino.nombrePureza.toLowerCase() }})
                                        </span></p>
                                    <p style="margin-bottom: 0.25rem; font-size:small;"><span
                                            class="font-weight-bold">Nacimiento:</span>
                                        {{ bovino?.fechaNacimientoFormateada ? bovino.fechaNacimientoFormateada : 'No
                                        registrada' }}
                                    </p>
                                    <p *ngIf="bovino?.registroNacimientoDefinitivo"
                                        style="margin-bottom: 0.25rem; font-size:small;"><span class="font-weight-bold">
                                            {{ bovino?.registroNacimientoDefinitivo }}</span>
                                    </p>
                                </td>
                                <td class="text-center">
                                    <p>
                                        <button type="button" class="btn waves-effect waves-light"
                                                style="background-color: #398bf7; color: white; border: none; border-radius: 25px; padding: 10px 20px; font-size: 14px; font-weight: bold; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); transition: all 0.3s ease; width: 180px;"
                                                [title]="generarTitulo(bovino)"
                                                (click)="asignarDatosFormularioAnimal(bovino?.idBovino)"
                                                onmouseover="this.style.backgroundColor='#2a7be4'; this.style.boxShadow='0 6px 8px rgba(0, 0, 0, 0.3)';"
                                                onmouseout="this.style.backgroundColor='#398bf7'; this.style.boxShadow='0 4px 6px rgba(0, 0, 0, 0.2)';">
                                            
                                            <i class="fas" 
                                               [class.fa-eye]="usuarioServicio.usuarioInterno"
                                               [class.fa-syringe]="!usuarioServicio.usuarioInterno"
                                               style="color: white; font-size: 18px; margin-right: 8px;"></i>
                                            
                                            {{ usuarioServicio.usuarioInterno ? 'Revisar' : 'Vacunación' }}
                                        </button>
                                    </p>
                                    <p><button type="button" class="btn waves-effect waves-light"
                                            style="background-color: #FFFF00; color: black; border: none; border-radius: 25px; padding: 10px 20px; font-size: 14px; font-weight: bold; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); transition: all 0.3s ease; width: 180px;"
                                            [title]="generarTitulo(bovino,'trazabilidad')"
                                            (click)="mostrarHistoricoBovino(bovino?.idBovino, bovino?.codigoIdentificacion)"
                                            onmouseover="this.style.backgroundColor='#FFEA00'; this.style.boxShadow='0 6px 8px rgba(0, 0, 0, 0.3)';"
                                            onmouseout="this.style.backgroundColor='#FFFF00'; this.style.boxShadow='0 4px 6px rgba(0, 0, 0, 0.2)';">
                                            <i class="fas fa-tag"
                                                style="color: black; font-size: 18px; margin-right: 8px;"></i>
                                            Trazabilidad
                                        </button></p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Formulario para modificar datos del animal -->
<div class='row' *ngIf="formularioVisible">
    <div class='col'>
        <div class='card border rounded border-info'>
            <!--Sitio de nacimiento del animal-->
            <div class='card-body border rounded shadow-sm p-2' style="background-color: #f8f9fa;">
                <h4 class="card-title text-white text-center py-2 bg-info" style="font-size: 14px;">
                    SITIO DE NACIMIENTO / REGISTRO
                </h4>
                <div class="card-body p-2">
                    <div class="row">
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Código-Sitio:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 12px; color: gray; font-weight: bold;">
                                        [{{ animalSeleccionado?.codigoSitioNacimiento }}] {{
                                        animalSeleccionado?.nombreSitioNacimiento.toUpperCase() }}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Ubicación:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 12px; color: gray; font-weight: bold;">
                                        {{ animalSeleccionado?.nombreProvinciaNacimiento.toUpperCase() }} / {{
                                        animalSeleccionado?.nombreCantonNacimiento.toUpperCase() }} / {{
                                        animalSeleccionado?.nombreParroquiaNacimiento.toUpperCase() }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Propietario:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 12px; color: gray; font-weight: bold;">
                                        [{{ animalSeleccionado?.identificacionPropietarioSitioNacimiento }}] {{
                                        animalSeleccionado?.nombresPropietarioSitioNacimiento.toUpperCase() }}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Dirección:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 12px; color: gray; font-weight: bold;">
                                        {{ animalSeleccionado?.callePrincipalSitioNacimiento.toUpperCase() }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Coordenadas:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 12px; color: gray; font-weight: bold;">
                                        LAT [{{ animalSeleccionado?.latitudSitioNacimiento }}] - LONG [{{
                                        animalSeleccionado?.longitudSitioNacimiento }}]
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Mapa:
                                </label>
                                <div class="col">
                                    <button class="styled-button"
                                        (click)="abrirGoogleMaps(animalSeleccionado?.latitudSitioNacimiento,animalSeleccionado?.longitudSitioNacimiento)">
                                        <i class="fas fa-map-marker-alt"></i>&nbsp;Ver en Google Maps
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--Sitio actual del animal-->
            <div class='card-body border rounded shadow-sm p-2' style="background-color: #f8f9fa;">
                <h4 class="card-title text-white text-center py-2 bg-secondary" style="font-size: 14px;">
                    SITIO ACTUAL
                </h4>
                <div class="card-body p-2">
                    <div class="row">
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Código-Sitio:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 12px; color: gray; font-weight: bold;">
                                        [{{ animalSeleccionado?.codigoSitioActual }}] {{
                                        animalSeleccionado?.nombreSitioActual.toUpperCase() }}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Ubicación:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 12px; color: gray; font-weight: bold;">
                                        {{ animalSeleccionado?.nombreProvinciaActual.toUpperCase() }} / {{
                                        animalSeleccionado?.nombreCantonActual.toUpperCase() }} / {{
                                        animalSeleccionado?.nombreParroquiaActual.toUpperCase() }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Propietario:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 12px; color: gray; font-weight: bold;">
                                        [{{ animalSeleccionado?.numeroIdentificacionUsuarioActual }}] {{
                                        animalSeleccionado?.nombresUsuarioActual.toUpperCase() }}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Dirección:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 12px; color: gray; font-weight: bold;">
                                        {{ animalSeleccionado?.callePrincipalSitioActual.toUpperCase() }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Coordenadas:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 12px; color: gray; font-weight: bold;">
                                        LAT [{{ animalSeleccionado?.latitudSitioActual }}] - LONG [{{
                                        animalSeleccionado?.longitudSitioActual }}]
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Mapa:
                                </label>
                                <div class="col">
                                    <button class="styled-button bg-secondary"
                                        (click)="abrirGoogleMaps(animalSeleccionado?.latitudSitioActual,animalSeleccionado?.longitudSitioActual)">
                                        <i class="fas fa-map-marker-alt"></i>&nbsp;Ver en Google Maps
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Registro reproductivo-->
            <div class='card-body border rounded shadow-sm p-2' style="background-color: #f8f9fa;">
                <h4 class="card-title text-white text-center py-2 bg-info" style="font-size: 14px;">
                    REGISTRO REPRODUCTIVO
                </h4>
                <div class="card-body p-2">
                    <div class="row">
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Tipo de servicio:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 14px; color: gray; font-weight: bold;">
                                        {{ animalSeleccionado?.nombreTipoServicio }}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div *ngIf="tipoServicioSeleccionado == 1 || tipoServicioSeleccionado == 2"
                                class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Código de pajuela:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 14px; color: gray; font-weight: bold;">
                                        {{ animalSeleccionado?.codigoPajuelaPadre.toUpperCase() }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div *ngIf="animalSeleccionado?.codigoIdentificacionBovinoMadre"
                                class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Arete de la madre:
                                </label>
                                <div class="col">
                                    <span class="badge rounded-pill"
                                        [ngClass]="animalSeleccionado?.codigoIdentificacionBovinoMadre ? 'badge-amarillo' : 'badge-secondary'"
                                        style="font-size: 14px;">
                                        {{ animalSeleccionado?.codigoIdentificacionBovinoMadre ?
                                        animalSeleccionado.codigoIdentificacionBovinoMadre :
                                        animalSeleccionado.idBovinoMadre }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div *ngIf="animalSeleccionado?.codigoIdentificacionBovinoPadre"
                                class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Arete del padre:
                                </label>
                                <div class="col">
                                    <span class="badge rounded-pill"
                                        [ngClass]="animalSeleccionado?.codigoIdentificacionBovinoPadre ? 'badge-amarillo' : 'badge-secondary'"
                                        style="font-size: 14px;">
                                        {{ animalSeleccionado?.codigoIdentificacionBovinoPadre ?
                                        animalSeleccionado.codigoIdentificacionBovinoPadre :
                                        animalSeleccionado.idBovinoPadre }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div *ngIf="animalSeleccionado?.codigoIdentificacionBovinoMadreDonadora"
                                class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Arete madre donadora:
                                </label>
                                <div class="col">
                                    <span class="badge rounded-pill"
                                        [ngClass]="animalSeleccionado?.codigoIdentificacionBovinoMadreDonadora ? 'badge-amarillo' : 'badge-secondary'"
                                        style="font-size: 14px;">
                                        {{ animalSeleccionado?.codigoIdentificacionBovinoMadreDonadora ?
                                        animalSeleccionado.codigoIdentificacionBovinoMadreDonadora :
                                        animalSeleccionado.idBovinoMadreDonadora }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                        </div>
                    </div>
                </div>
            </div>
            <!-- Pedigri e identificacion-->
            <div class='card-body border rounded shadow-sm p-2' style="background-color: #f8f9fa;">
                <h4 class="card-title text-white text-center py-2 bg-secondary" style="font-size: 14px;">
                    PEDIGRÍ E IDENTIFICACIÓN
                </h4>
                <div class="card-body p-2">
                    <div class="row">
                        <div class="col">
                            <div *ngIf="animalSeleccionado?.fechaNacimiento" class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Fecha nacimiento:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 14px; color: gray; font-weight: bold;">
                                        {{ animalSeleccionado?.fechaNacimientoFormateada }}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Raza predominante:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 14px; color: gray; font-weight: bold;">
                                        {{ animalSeleccionado?.idCategoria ? animalSeleccionado?.nombreComunRaza :
                                        'NA' }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Categoría etaria:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 14px; color: gray; font-weight: bold;">
                                        {{ animalSeleccionado?.nombreCategoria }}
                                        [ {{ animalSeleccionado?.nombreComunTaxonomia.toLowerCase() }} - {{
                                        animalSeleccionado?.codigoSexo.toLowerCase() }} ]
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Pureza:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 14px; color: gray; font-weight: bold;">
                                        {{ animalSeleccionado?.idCategoria ? animalSeleccionado?.nombrePureza : 'NA'
                                        }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Procedencia:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 14px; color: gray; font-weight: bold;">
                                        {{ animalSeleccionado?.idPaisProcedencia == 19 ? 'Nacional' : 'Importado' }}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    País de procedencia:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 14px; color: gray; font-weight: bold;">
                                        {{ animalSeleccionado?.idPaisProcedencia !== 19 ?
                                        animalSeleccionado?.nombrePaisProcedencia : 'NA' }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px;">
                                    Nro. Certificado Registro:
                                </label>
                                <div class="col">
                                    <p class="form-control-static border px-2 py-1 rounded bg-white m-0"
                                        style="font-size: 14px; color: gray; font-weight: bold;">
                                        {{ animalSeleccionado?.registroNacimientoDefinitivo ?
                                        animalSeleccionado.registroNacimientoDefinitivo.toUpperCase() : 'NA' }}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group row align-items-center">
                                <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                    style="font-size: 14px; font-weight: bold;">
                                    {{ animalSeleccionado?.codigoIdentificacion ? 'Arete oficial:' : 'Código:' }}
                                </label>
                                <div class="col">
                                    <span class="badge rounded-pill"
                                        [ngClass]="animalSeleccionado?.codigoIdentificacion ? 'badge-amarillo' : 'badge-secondary'"
                                        style="font-size: 14px;">
                                        {{ animalSeleccionado?.codigoIdentificacion ?
                                        animalSeleccionado.codigoIdentificacion : animalSeleccionado.idBovino }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Registro de vacunación -->
            <form *ngIf="!usuarioServicio.usuarioInterno" ngNativeValidate [formGroup]="formulario" class="form-horizontal r-separator">
                <div class='card-body border rounded shadow-sm p-2' style="background-color: #f8f9fa;">
                    <h4 class="card-title text-white text-center py-2 bg-info" style="font-size: 14px;">
                        REGISTRO DE VACUNACIÓN
                    </h4>
                    <div *ngIf="listaBovinosOtrasVacunaciones.length > 0" class="card-body p-2">
                        <div class="row">
                            <div class="col">
                                <div class="card border-info rounded">
                                    <div class="table-wrapper-scroll-y custom-scrollbar">
                                        <table class="table table-bordered table-hover v-middle mb-1"
                                            style="margin-bottom: 0;">
                                            <thead>
                                                <tr
                                                    style="background-color: #d9dde2; color: rgb(21, 20, 20); line-height: 1.2;">
                                                    <th class="text-center" style="padding: 5px 20px; font-size: 13px;">
                                                        ID</th>
                                                    <th class="text-center" style="padding: 5px 20px; font-size: 13px;">
                                                        Fecha vacunación</th>
                                                    <th class="text-center" style="padding: 5px 20px; font-size: 13px;">
                                                        Vacuna</th>
                                                    <th class="text-center" style="padding: 5px 20px; font-size: 13px;">
                                                        Aplicada por</th>
                                                    <th class="text-center" style="padding: 5px 20px; font-size: 13px;">
                                                        Fecha registro
                                                    </th>
                                                    <th class="text-center" style="padding: 5px 20px; font-size: 13px;">
                                                        Eliminar</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr *ngFor="let vacuna of listaBovinosOtrasVacunaciones"
                                                    style="line-height: 1.2;">
                                                    <td class="text-center" style="padding: 4px 15px; font-size: 12px;">
                                                        <span class="font-weight-bold">
                                                            {{ vacuna?.idOtrasVacunaciones }}
                                                        </span>
                                                    </td>
                                                    <td class="text-center" style="padding: 4px 15px; font-size: 12px;">
                                                        <span class="font-weight-bold">
                                                            {{ vacuna?.fechaVacunacionFormateada }}
                                                        </span>
                                                    </td>
                                                    <td class="text-center" style="padding: 4px 15px; font-size: 12px;">
                                                        <span class="font-weight-bold">
                                                            {{ vacuna?.nombreVacuna }}
                                                        </span>
                                                    </td>
                                                    <td class="text-center font-weight-bold"
                                                        style="padding: 4px 15px; font-size: 10px;">
                                                        {{ vacuna?.identificacionOperador.toUpperCase() }} - {{
                                                        vacuna?.nombreOperador.toUpperCase() }}
                                                    </td>
                                                    <td class="text-center font-weight-bold"
                                                        style="padding: 4px 15px; font-size: 12px;">
                                                        {{ vacuna?.fechaCreacionFormateada }}
                                                    </td>
                                                    <td class="text-center" style="padding: 4px 15px;">
                                                        <button type="button"
                                                            class="btn btn-danger d-flex align-items-center justify-content-center"
                                                            style="width: 1.5em; height: 1.5em; padding: 0; margin: 0 auto;"
                                                            (click)="eliminarVacunacion(vacuna)">
                                                            <i class="fa fa-times-circle" style="font-size: 1em;"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-2">
                        <div class="row">
                            <div class="col">
                                <div class="form-group row align-items-center">
                                    <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                        style="font-size: 14px;">
                                        Vacuna aplicada:<span class="text-danger font-weight-bold"> *</span>
                                    </label>
                                    <div class="col d-flex">
                                        <select formControlName="inputIdVacuna"
                                            class="border px-2 py-1 rounded ml-2 bg-white m-0 w-100"
                                            style="font-size: 14px; height: 35px; border: 1px solid black !important;">
                                            <option [value]="-1" selected enabled>--- Seleccione una opción ---
                                            </option>
                                            <option [value]="vacuna.id_vacunas_oficiales"
                                                *ngFor="let vacuna of listaVacunasOficiales">{{
                                                vacuna.nombre }}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group row align-items-center">
                                    <label class="control-label col-md-3 text-right px-2 font-weight-bold"
                                        style="font-size: 14px;">
                                        Fecha vacunación:<span class="text-danger font-weight-bold"> *</span>
                                    </label>
                                    <div class="col">
                                        <input formControlName="inputFechaVacunacion" type="date"
                                            class="border px-2 py-1 rounded bg-white m-0 w-100"
                                            style="font-size: 14px; height: 35px; border: 1px solid black !important;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group row align-items-center mb-0">
                    <div class="col-md-9 pb-2 pt-2">
                        <p class="text-muted mb-3 font-weight-bold" style="font-size: 0.9rem; padding-left: 4%;">
                            <em>Los campos marcados con <span class="text-danger font-weight-bold">*</span> son
                                obligatorios.</em>
                        </p>
                    </div>
                </div>
            </form>
            <div class="card-body">
                <div class="form-group mb-0 text-center">
                    <button *ngIf="!usuarioServicio.usuarioInterno" class="btn btn-info btn-lg font-weight-bold font-16 text-uppercase mx-2"
                        style="width: 48%;" type="button" (click)="registrarVacunacion()">Registrar</button>
                    <button class="btn btn-danger btn-lg font-weight-bold font-16 text-uppercase mx-2"
                        style="width: 48%;" type="button" (click)="botonCancelar()">Salir</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Panel para mostrar información flotante -->
<div class="customizer-overlay" *ngIf="panelHistorico" (click)="cerrarPanel()"></div>
<aside class="customizer" [ngClass]="{ 'show-service-panel': panelHistorico}" (click)="$event.stopPropagation()">
    <div class="text-center" *ngIf="consultando">
        <div class="spinner-border m-3" role="status">
            <span class="sr-only">Cargando...</span>
        </div>
    </div>
    <div #panelScrollContainer class="customizer-body">
        <div class="tab-content">
            <div class="tab-pane fade show active" id="pills-contact" role="tabpanel"
                aria-labelledby="pills-contact-tab">
                <div class="text-center">
                    <div class="text-center">
                        <h4 class="mt-3 mb-3 display-7 badge rounded-pill badge-amarillo">{{ this.codigoOficial }}</h4>
                    </div>
                </div>
                <div class="steamline">
                    <!-- Listado de historias -->
                    <div class="sl-item" *ngFor="let historia of listaHistoriasBovino">
                        <div class="sl-left bg-success">
                            <i class="fas fa-truck" *ngIf="historia.tipoHistoria.codigo === 'MOV'"></i>
                            <i class="fas fa-heart" *ngIf="historia.tipoHistoria.codigo === 'NCT'"></i>
                            <i class="fas fa-syringe" *ngIf="historia.tipoHistoria.codigo === 'VAC'"></i>
                            <i class="ti-check-box" *ngIf="historia.tipoHistoria.codigo === 'CTRL-M'"></i>
                            <i class="fas fa-tag" *ngIf="historia.tipoHistoria.codigo === 'IDI'"></i>
                            <i class="fas fa-stethoscope" *ngIf="historia.tipoHistoria.codigo === 'ATEN-VET'"></i>
                            <i class="fas fa-stethoscope" *ngIf="historia.tipoHistoria.codigo === 'RART'"></i>
                            <img *ngIf="historia.tipoHistoria.codigo === 'PTO'" src="assets/images/icon/parto.png"
                                width="24" alt="Parto bovino" class="mr-3"
                                style="vertical-align: middle; margin: 0 8px;" />
                            <i class="fas fa-ribbon" *ngIf="historia.tipoHistoria.codigo === 'FNT'"></i>
                            <i class="fas fa-clock" *ngIf='historia.tipoHistoria.codigo === "AEDAD"'></i>
                            {{historia.tipoHistoria.codigo}}
                        </div>
                        <div class="sl-right">
                            <div class="font-weight-medium">
                                {{ historia.tipoHistoria?.nombre }} <span class="sl-date"> {{ historia.fechaCreacion
                                    }}</span>
                            </div>
                            <div class="desc">{{ historia.detalle }}</div>
                        </div>
                    </div>
                    <!-- Botón "Cerrar panel" al final de la lista -->
                    <div class="text-center mt-4" *ngIf="listaHistoriasBovino?.length > 0">
                        <button type="button" class="btn btn-danger font-weight-bold" style="font-size: small;"
                            (click)="cerrarPanel()">
                            <i class="fas fa-window-close me-2"></i> CERRAR PANEL
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</aside>