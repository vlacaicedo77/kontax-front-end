<!-- Sección para buscar animales para actualización de categoría etaria (sin arete) -->
<div class="row">
    <div class="col">
        <div class="card border border-info rounded">
            <div class="card-header bg-info text-white rounded-top font-weight-bold">
                Buscar animales para actualización de categoría etaria
            </div>
            <form ngNativeValidate [formGroup]="formularioBusqueda" class="form-horizontal r-separator">
                <div class="card-body">
                    <div class="form-group row align-items-center mb-0">
                        <label class="col-md-3 text-right control-label col-form-label font-weight-bold">Mis sitios
                            activos</label>
                        <div class="col-md-8 border-left pb-2 pt-2">
                            <select formControlName="inputSitio" class="form-control border-secondary font-weight-bold"
                                #idSitio (change)="cambioSitio(idSitio.value)">
                                <option [value]="null" selected disabled>--- Seleccione una opción ---</option>
                                <option *ngFor="let area of listaAreas" [value]="area.idSitio">{{
                                    area.codigoSitio.toUpperCase()}} | {{ area.nombreProvinciaSitio.toUpperCase()}} - {{
                                    area.nombreCantonSitio.toUpperCase()}} | {{ area.nombre.toUpperCase() }}</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row align-items-center mb-0">
                        <label class="col-md-3 text-right control-label col-form-label font-weight-bold">Tipo
                            catastro</label>
                        <div class="col-md-4 border-left pb-2 pt-2 input-group">
                            <select class="form-control border-secondary font-weight-bold"
                                formControlName="inputTipoCatastro" (change)="cambioTipoCatastro()">
                                <option *ngFor="let tipo of listaTiposCatastro" [value]="tipo.codigo">{{ tipo.nombre }}
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row align-items-center mb-0">
                        <label class="col-md-3 text-right control-label col-form-label font-weight-bold">Categoría
                            etaria</label>
                        <div class="col-md-4 border-left pb-2 pt-2 input-group">
                            <select class="form-control border-secondary font-weight-bold"
                                formControlName="inputCategoria" (change)="cambioCategoria()">
                                <option [value]="null" selected disabled>--- Seleccione una opción ---</option>
                                <option *ngFor="let categoria of categorias" [value]="categoria.id_categoria">
                                    {{ categoria.nombre }}
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row align-items-center mb-0">
                        <label class="col-md-3 text-right control-label col-form-label font-weight-bold">ID</label>
                        <div class="col-md-4 border-left pb-2 pt-2 input-group">
                            <input type="text" class="form-control border-secondary text-uppercase" autocomplete="on"
                                formControlName="inputIdOficial" (keypress)="soloNumeros($event)" maxlength="11">
                            <div class="input-group-append">
                                <button type="button" class="btn btn-info border-secondary font-weight-bold"
                                    (click)="buscarAnimales(true,true)">
                                    <i class="fas fa-search"></i> Buscar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Panel para mostrar datos del sitio seleccionado -->
<div class="row">
    <div class="col">
        <form ngNativeValidate [formGroup]="formularioDatosSitio" class="form-horizontal r-separator">
            <!-- Botón para ocultar/mostrar -->
            <button *ngIf="isVisibleBotonDetalles" class="btn btn-info mb-3 font-weight-bold"
                (click)="toggleVisibility()">
                <i class="fas {{ isVisible ? 'fa-eye-slash' : 'fa-eye' }}"></i>
                {{ isVisible ? 'Ocultar' : 'Mostrar' }} detalles del sitio
            </button>
            <!-- Datos del sitio -->
            <div class="row" *ngIf="isVisible">
                <div class="col">
                    <div class="card border rounded">
                        <div class="card-body">
                            <table class="table mt-3 table-borderless v-middle custom-table">
                                <tbody>
                                    <tr>
                                        <td></td>
                                        <td class="pl-0 text-left">PROPIETARIO:</td>
                                        <td class="pl-0 text-left font-weight-medium">
                                            <p>
                                                <span class="pl-0 text-left font-weight-medium">
                                                    [{{
                                                    sitioSeleccionado?.numeroIdentificacion
                                                    }}]
                                                </span>
                                                <span>&nbsp;&nbsp;</span>
                                                <span class="pl-0 text-left font-weight-medium">
                                                    {{
                                                    sitioSeleccionado?.nombres.toUpperCase()
                                                    }}
                                                </span>
                                            </p>
                                        </td>
                                        <td class="pl-0 text-left">PROVINCIA:</td>
                                        <td class="pl-0 text-left font-weight-medium">{{
                                            sitioSeleccionado?.nombreProvinciaSitio.toUpperCase()
                                            }}</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td class="pl-0 text-left">CÓDIGO-SITIO:</td>
                                        <td class="pl-0 text-left font-weight-medium">

                                            <p><span class="badge rounded-pill font-weight-bold letra badge-info">
                                                    {{ sitioSeleccionado?.codigoSitio }}
                                                </span></p>
                                        </td>
                                        <td class="pl-0 text-left">CANTÓN:</td>
                                        <td class="pl-0 text-left font-weight-medium">{{
                                            sitioSeleccionado?.nombreCantonSitio.toUpperCase()
                                            }}</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td class="pl-0 text-left">TIPO ÁREA:</td>
                                        <td class="pl-0 text-left font-weight-medium">{{
                                            sitioSeleccionado?.nombreTipoArea.toUpperCase() }}
                                        </td>
                                        <td class="pl-0 text-left">PARROQUIA:</td>
                                        <td class="pl-0 text-left font-weight-medium">{{
                                            sitioSeleccionado?.nombreParroquiaSitio.toUpperCase()
                                            }}</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td class="pl-0 text-left">NOMBRE-SITIO:</td>
                                        <td class="pl-0 text-left font-weight-medium">{{
                                            sitioSeleccionado?.nombre.toUpperCase() }}</td>
                                        <td class="pl-0 text-left">DIRECCIÓN:</td>
                                        <td class="pl-0 text-left font-weight-medium">{{
                                            sitioSeleccionado?.callePrincipalSitio.toUpperCase()
                                            }}</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td class="pl-0 text-left">COORDENADAS:</td>
                                        <td class="pl-0 text-left font-weight-medium">
                                            LAT [{{ sitioSeleccionado?.latitudSitio }}] - LONG
                                            [{{
                                            sitioSeleccionado?.longitudSitio }}]
                                        </td>
                                        <td class="pl-0 text-left">MAPA:</td>
                                        <td class="pl-0 text-left font-weight-medium">
                                            <button class="styled-button bg-info"
                                                (click)="abrirGoogleMaps(sitioSeleccionado?.latitudSitio,sitioSeleccionado?.longitudSitio)">
                                                <i class="fas fa-map-marker-alt"></i>&nbsp;Ver
                                                en
                                                Google Maps
                                            </button>
                                        </td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<hr class="mt-0" />
<!-- Tabla con el resultado de la búsqueda -->
<div class="row" *ngIf="listaBovinos.length > 0">
    <div class="col">
        <div class="card border-info rounded">
            <div class="card-header bg-secondary text-white" *ngIf="listaBovinos.length > 0">
                <span class="font-weight-bold">
                    Listado de animales disponibles para actualización de categoría etaria
                </span>
                <span class="round rounded-circle text-white font-weight-bold d-inline-block text-center bg-info">{{
                    listaBovinos.length }}</span>
                <div class="btn-group ml-2" role="group" aria-label="Navegar">
                    <button (click)="anterior()" type="button" class="btn btn-success" *ngIf="inicio > 0"><i
                            class="fa fa-fast-backward"></i></button>
                    <button (click)="siguiente()" type="button" class="btn btn-success"
                        *ngIf="listaBovinos.length > 99"><i class="fa fa-fast-forward"></i></button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-wrapper-scroll-y custom-scrollbar">
                    <table class="table table-bordered table-hover v-middle">
                        <thead>
                            <tr>
                                <th class="badge-light-info font-16 text-center">ID</th>
                                <th class="badge-light-info font-16">Ubicación</th>
                                <th class="badge-light-info font-16 text-center">Categoría actual</th>
                                <th class="badge-light-info font-16 text-center">Categoría nueva</th>
                                <th class="badge-light-info font-16 text-center">Operación</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let bovino of listaBovinos">
                                <td class="text-center">
                                    <span class="badge rounded-pill"
                                        [ngClass]="bovino?.codigoIdentificacion ? 'badge-amarillo' : 'badge-secondary'">
                                        {{ bovino?.codigoIdentificacion ? bovino.codigoIdentificacion : bovino.idBovino
                                        }}
                                    </span>
                                </td>
                                <td>
                                    <p><span class="badge rounded-pill font-weight-bold letra badge-info"
                                            style="font-size:small;">
                                            {{ bovino.codigoSitioActual }}
                                        </span></p>
                                    <p><span class="font-weight-bold" style="font-size:small;">{{
                                            bovino.nombreAreaActual.toUpperCase() }}</span></p>
                                    <p class="font-weight-bold" style="font-size:x-small;">
                                        [{{ bovino.numeroIdentificacionUsuarioActual }}] - {{
                                        bovino.nombresUsuarioActual
                                        }}
                                    </p>
                                    <p style="font-size:smaller;">
                                        {{ bovino.nombreProvinciaActual }} /
                                        {{ bovino.nombreCantonActual }} /
                                        {{ bovino.nombreParroquiaActual }}
                                    </p>
                                </td>
                                <td class="text-center">
                                    <p style="margin-bottom: 0.25rem;"><img
                                            style="vertical-align: middle; margin: 0 8px;" class="mr-3"
                                            src="assets/images/icon/vaca.svg" [hidden]="bovino.codigoSexo === 'macho'"
                                            width="40" alt="Generic placeholder image" />
                                        <img style="vertical-align: middle; margin: 0 8px;" class="mr-3"
                                            src="assets/images/icon/toro.svg" [hidden]="bovino.codigoSexo === 'hembra'"
                                            width="40" alt="Generic placeholder image" />
                                    </p>
                                    <p style="margin-bottom: 0.25rem;"><span class="font-weight-bold"
                                            style="font-size:small;">
                                            {{ bovino?.nombreCategoria ? bovino.nombreCategoria :
                                            bovino.nombreComunTaxonomia }}
                                        </span></p>
                                    <p style="margin-bottom: 0.25rem;"><span class="badge rounded-pill font-weight-bold"
                                            [ngClass]="{'badge-gris':bovino.estadoVacunacion=='vacunado', 'badge-light-danger':bovino.estadoVacunacion=='nacimiento'}">
                                            {{ bovino.estadoVacunacion.toLowerCase() }}
                                        </span>
                                    </p>
                                    <p style="margin-bottom: 0.25rem; font-size:small;"><span
                                            class="font-weight-bold">Nacimiento:</span>
                                        {{ bovino?.fechaNacimientoFormateada ? bovino.fechaNacimientoFormateada : 'No
                                        registrada' }}
                                    </p>
                                </td>
                                <td class="text-center">
                                    <p style="margin-bottom: 0.25rem;">
                                        <img style="vertical-align: middle; margin: 0 8px;" class="mr-3"
                                            src="assets/images/icon/vaca.svg" [hidden]="bovino.codigoSexo === 'macho'"
                                            width="40" alt="Generic placeholder image" />
                                        <img style="vertical-align: middle; margin: 0 8px;" class="mr-3"
                                            src="assets/images/icon/toro.svg" [hidden]="bovino.codigoSexo === 'hembra'"
                                            width="40" alt="Generic placeholder image" />
                                    </p>
                                    <p style="margin-bottom: 0.25rem;">
                                        <span class="font-weight-bold" style="font-size:small;">
                                            {{ obtenerSiguienteCategoria(bovino) }}
                                        </span>
                                    </p>
                                    <p style="margin-bottom: 0.25rem;">
                                        <span class="badge rounded-pill font-weight-bold"
                                            [ngClass]="{'badge-gris':bovino.estadoVacunacion=='vacunado', 'badge-light-danger':bovino.estadoVacunacion=='nacimiento'}">
                                            {{ bovino.estadoVacunacion.toLowerCase() }}
                                        </span>
                                    </p>
                                    <p style="margin-bottom: 0.25rem; font-size:small;">
                                        <span class="font-weight-bold">
                                            {{ bovino?.fechaActCategoriaFormateada ? 'Últ. actualización:' : 'Registro:' }}
                                        </span>
                                        {{ bovino?.fechaActCategoriaFormateada || bovino?.fechaCreacionFormateada || 'No registrada' }}
                                    </p>
                                </td>
                                <td class="text-center">
                                    <p>
                                        <button type="button" class="btn waves-effect waves-light"
                                            style="background-color: #398bf7; color: white; border: none; border-radius: 25px; padding: 10px 20px; font-size: 14px; font-weight: bold; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); transition: all 0.3s ease; width: 180px;"
                                            [title]="generarTitulo(bovino)"
                                            (click)="actualizarAnimal(bovino)"
                                            onmouseover="this.style.backgroundColor='#2a7be4'; this.style.boxShadow='0 6px 8px rgba(0, 0, 0, 0.3)';"
                                            onmouseout="this.style.backgroundColor='#398bf7'; this.style.boxShadow='0 4px 6px rgba(0, 0, 0, 0.2)';">
                                            <i class="fa fa-exchange-alt"
                                                style="color: white; font-size: 18px; margin-right: 8px;"></i>
                                            Cambiar
                                        </button>
                                    </p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>